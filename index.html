<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rose Day Quest üåπ</title>
  <style>
    :root { --bg1:#0b1020; --bg2:#1b0f1a; --card:#0f1730cc; --text:#f6f6fb; --muted:#c9c9d6; }
    * { box-sizing: border-box; }
    body{
      margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background: radial-gradient(1200px 800px at 20% 20%, #2a2f55 0%, transparent 60%),
                  radial-gradient(1000px 700px at 80% 30%, #4b1f3a 0%, transparent 55%),
                  linear-gradient(160deg, var(--bg1), var(--bg2));
      padding: 24px;
      overflow-x:hidden;
    }
    .wrap{ width:min(900px, 100%); }
    .card{
      background: var(--card);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 22px;
      padding: 22px;
      box-shadow: 0 18px 60px rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
      position: relative;
    }
    h1{ margin:0 0 6px; font-size: clamp(26px, 4vw, 40px); }
    h2{ margin: 0 0 8px; font-size: 18px; }
    p{ margin: 8px 0; color: var(--muted); line-height: 1.5; }
    .row{ display:flex; flex-wrap:wrap; gap:14px; margin-top: 16px; }
    .panel{ flex: 1 1 280px; padding:16px; border-radius:16px; background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10); }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 12px; border-radius: 999px;
      background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.12);
      font-size: 14px; color: var(--muted);
    }
    input, button{
      font: inherit;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.22);
      color: var(--text);
      padding: 12px 12px;
      width: 100%;
      outline: none;
    }
    input:focus{ border-color: rgba(255,255,255,.35); }
    button{
      cursor:pointer;
      background: linear-gradient(135deg, #ff4d7d, #ff9a5c);
      border: none;
      font-weight: 800;
      letter-spacing: .2px;
      transition: transform .08s ease;
      user-select:none;
    }
    button:hover{ transform: translateY(-1px); }
    button:active{ transform: translateY(1px); }
    .btn-secondary{
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.18);
      font-weight: 650;
    }
    .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    @media (max-width:640px){ .grid2{ grid-template-columns:1fr; } }

    .toast{ margin-top: 10px; padding: 10px 12px; border-radius: 12px; display:none; }
    .ok{ display:block; background: rgba(0,255,160,.12); border:1px solid rgba(0,255,160,.25); color:#bfffe8; }
    .bad{ display:block; background: rgba(255,70,70,.12); border:1px solid rgba(255,70,70,.25); color:#ffd0d0; }

    /* Step 1: "No" button runs away */
    .runZone{
      position: relative;
      height: 230px;
      border-radius: 16px;
      background: rgba(0,0,0,.18);
      border: 1px dashed rgba(255,255,255,.18);
      overflow: hidden;
      padding: 14px;
    }
    .runZone .note{ font-size: 13px; color: var(--muted); margin-top: 8px; }
    #yesBtn{ max-width: 260px; }
    #noBtn{
      position: absolute;
      width: 200px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.18);
      font-weight: 700;
    }

    /* Rose & final */
    .roseWrap{ display:flex; flex-direction:column; align-items:center; gap: 14px; padding: 10px 0 0; }
    .rose{
      width: 140px; height: 140px; border-radius: 28px;
      background: radial-gradient(circle at 30% 30%, #ffd1dc 0%, #ff4d7d 35%, #b10b3a 70%, #4a061a 100%);
      position:relative;
      box-shadow: 0 18px 60px rgba(255,77,125,.25);
      transform: rotate(8deg);
    }
    .rose:before, .rose:after{
      content:""; position:absolute; inset: 22px;
      border-radius: 24px;
      background: radial-gradient(circle at 40% 40%, rgba(255,255,255,.55), rgba(255,255,255,0) 55%);
      mix-blend-mode: screen;
    }
    .stem{
      width: 12px; height: 140px; background: linear-gradient(#2fff7a, #0b5b2a);
      border-radius: 12px; margin-top: -6px;
      position: relative;
      box-shadow: 0 12px 40px rgba(0,255,120,.15);
    }
    .leaf{
      position:absolute; width: 60px; height: 30px; border-radius: 60px 60px 60px 0;
      background: linear-gradient(135deg, #37ff86, #0a6d35);
      top: 58px; left: 6px; transform: rotate(-18deg);
      opacity:.9;
    }
    .leaf.r{ left: -54px; transform: rotate(198deg); top: 86px; }
    .photo{
      width: min(560px, 100%);
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.16);
      overflow:hidden;
      background: rgba(255,255,255,.06);
    }
    .photo img{ display:block; width:100%; height:auto; }

    .small{ font-size: 13px; color: var(--muted); }
    .footer{
      margin-top: 14px; display:flex; gap: 10px; flex-wrap:wrap; align-items:center; justify-content:space-between;
    }
    .linklike{ font-size: 13px; color: #ffd1dc; opacity: .9; }

    canvas#fx{ position:fixed; inset:0; pointer-events:none; }

    /* Make buttons tappable on iOS without delay */
    button { touch-action: manipulation; }
  </style>
</head>
<body>
<canvas id="fx"></canvas>

<div class="wrap">
  <div class="card" id="app"></div>
  <p class="small" style="text-align:center;margin-top:12px;">
    Tip: put <b>us.jpg</b> in the same folder for the final photo.
  </p>
</div>

<script>
(() => {
  // ======= Customize =======
  const HER_NAME = "Finnja";
  const HER_NICK = "Tiya";
  const YOUR_NAME = "Abhi";
  const FINAL_NOTE = "Happy Rose Day üåπ You‚Äôre my favorite person ‚Äî today and always.";
  const PHOTO_FILENAME = "us.jpg";

  // ======= State =======
  const app = document.getElementById("app");
  const state = { step: 0 };

  // ======= Views =======
  function viewIntro(){
    return `
      <div class="pill">üåπ Rose Day Quest ‚Ä¢ made by ${YOUR_NAME}</div>
      <h1>Hi ${HER_NAME} (aka ${HER_NICK}) ‚ú®</h1>
      <p>
        I made you a tiny quest. Complete the challenges and you‚Äôll get your rose.
      </p>

      <div class="row">
        <div class="panel">
          <h2>Rules</h2>
          <p style="margin:0;">No stress. Just tap, smile, and win üòå</p>
          <div class="footer">
            <span class="linklike">Ready, ${HER_NICK}?</span>
            <button id="startBtn">Start the quest ‚Üí</button>
          </div>
        </div>

        <div class="panel">
          <h2>Hint</h2>
          <p style="margin:0;">
            If an option seems ‚Äúimpossible‚Äù‚Ä¶ that‚Äôs because I‚Äôm mischievous.
          </p>
        </div>
      </div>
    `;
  }

  // Step 1: Candle light dinner + runaway "No"
  function viewStep1(){
    return `
      <div class="pill">Challenge 1 of 2 ‚Ä¢ üïØÔ∏è Candle light dinner</div>
      <h1>Important question, ${HER_NICK}‚Ä¶</h1>
      <p>Would you like a candle light dinner?</p>

      <div class="row">
        <div class="panel">
          <div class="runZone" id="zone">
            <div class="grid2" style="max-width: 560px;">
              <button id="yesBtn">Yes ‚úÖ</button>
              <!-- No button is absolutely positioned so it can run -->
              <button id="noBtn" type="button">No ‚ùå</button>
            </div>
            <div class="note">Try tapping ‚ÄúNo‚Äù if you dare üòÑ</div>
            <div id="msg1" class="toast"></div>
          </div>
          <p class="small" style="margin-top:10px;">(I know what the correct answer is.)</p>
        </div>

        <div class="panel">
          <h2>Mini hint</h2>
          <p style="margin:0;">The universe has only one stable outcome here.</p>
        </div>
      </div>

      <div class="footer">
        <button class="btn-secondary" id="back0">‚Üê Back</button>
        <span class="small">2 challenges total ‚Üí then rose.</span>
      </div>
    `;
  }

  // Step 2: Favourite soft toy name (Stitch accepted in any case)
  function viewStep2(){
    return `
      <div class="pill">Challenge 2 of 2 ‚Ä¢ üß∏ Soft toy test</div>
      <h1>One last thing‚Ä¶</h1>
      <p>What is the name of my favourite soft toy?</p>

      <div class="row">
        <div class="panel">
          <div class="grid2">
            <input id="toy" placeholder="type your answer‚Ä¶" autocomplete="off" />
            <button id="check2">Submit</button>
          </div>
          <div id="msg2" class="toast"></div>
          <p class="small" style="margin-top:10px;">Caps, small letters ‚Äî all fine.</p>
        </div>

        <div class="panel">
          <h2>Hint</h2>
          <p style="margin:0;">Blue. Cute. Chaos. üëÄ</p>
        </div>
      </div>

      <div class="footer">
        <button class="btn-secondary" id="back1">‚Üê Back</button>
        <span class="small">Answer correctly ‚Üí final gift.</span>
      </div>
    `;
  }

  function viewFinal(){
    return `
      <div class="pill">Quest complete ‚Ä¢ üåπ</div>
      <h1>For you, ${HER_NAME} üíó</h1>
      <p>${FINAL_NOTE}</p>

      <div class="row">
        <div class="panel">
          <div class="roseWrap">
            <div class="rose" aria-hidden="true"></div>
            <div class="stem" aria-hidden="true">
              <div class="leaf"></div>
              <div class="leaf r"></div>
            </div>
            <button id="moreFx">More confetti ‚ú®</button>
          </div>
        </div>

        <div class="panel">
          <h2>Us ü´∂</h2>
          <div class="photo">
            <img src="${PHOTO_FILENAME}" alt="Us"
              onerror="this.closest('.photo').innerHTML='<div style=&quot;padding:14px;color:#ffd1dc&quot;>Add your photo as <b>${PHOTO_FILENAME}</b> next to <b>index.html</b> ‚ú®</div>';">
          </div>
          <p class="small" style="margin-top:10px;">If it doesn‚Äôt show: check filename + upload both files.</p>
        </div>
      </div>

      <div class="footer">
        <button class="btn-secondary" id="restart">Play again</button>
        <span class="small">Made with love by ${YOUR_NAME}.</span>
      </div>
    `;
  }

  // ======= Router =======
  function goto(step){ state.step = step; render(); }

  function render(){
    if (state.step === 0) app.innerHTML = viewIntro();
    if (state.step === 1) app.innerHTML = viewStep1();
    if (state.step === 2) app.innerHTML = viewStep2();
    if (state.step === 3) app.innerHTML = viewFinal();
    bind();
  }

  // ======= Bind handlers =======
  function bind(){
    // Intro
    const startBtn = document.getElementById("startBtn");
    if (startBtn) startBtn.onclick = () => goto(1);

    // Back buttons
    const back0 = document.getElementById("back0");
    if (back0) back0.onclick = () => goto(0);

    const back1 = document.getElementById("back1");
    if (back1) back1.onclick = () => goto(1);

    // Step 1 logic
    const yesBtn = document.getElementById("yesBtn");
    if (yesBtn){
      yesBtn.onclick = () => {
        const msg = document.getElementById("msg1");
        msg.className = "toast ok";
        msg.textContent = "Correct choice üòå Proceeding‚Ä¶";
        popConfetti();
        setTimeout(() => goto(2), 650);
      };
    }

    const zone = document.getElementById("zone");
    const noBtn = document.getElementById("noBtn");
    if (zone && noBtn){
      // place No initially
      placeNoButtonRandomly(zone, noBtn);

      // Make "No" run away on hover/mousemove AND on touchstart for phones
      const flee = (e) => {
        // prevent accidental click/tap
        e.preventDefault?.();
        e.stopPropagation?.();
        moveNoButton(zone, noBtn);
        const msg = document.getElementById("msg1");
        msg.className = "toast bad";
        msg.textContent = "Nice try üòÑ";
      };

      // Desktop
      noBtn.addEventListener("mouseenter", flee);
      noBtn.addEventListener("mousemove", flee);

      // Mobile (iOS)
      noBtn.addEventListener("touchstart", flee, { passive:false });

      // In case she somehow clicks it
      noBtn.addEventListener("click", flee);
    }

    // Step 2 logic
    const check2 = document.getElementById("check2");
    if (check2){
      check2.onclick = () => {
        const val = (document.getElementById("toy").value || "").trim().toLowerCase();
        const msg = document.getElementById("msg2");
        if (val === "stitch"){
          msg.className = "toast ok";
          msg.textContent = "Yesss üòå You know me.";
          popConfetti();
          setTimeout(() => goto(3), 650);
        } else {
          msg.className = "toast bad";
          msg.textContent = "Nope üòÑ Try again.";
        }
      };
    }

    // Final
    const moreFx = document.getElementById("moreFx");
    if (moreFx) moreFx.onclick = () => popConfetti(180);

    const restart = document.getElementById("restart");
    if (restart) restart.onclick = () => goto(0);
  }

  // ======= Runaway button helpers =======
  function placeNoButtonRandomly(zone, btn){
    const rect = zone.getBoundingClientRect();
    // keep inside zone with padding, avoid top-left where Yes is
    const pad = 14;
    const bw = 200, bh = 48;

    // place somewhere in lower area by default
    const x = rand(pad, Math.max(pad, rect.width - bw - pad));
    const y = rand(90, Math.max(90, rect.height - bh - pad));

    btn.style.left = x + "px";
    btn.style.top  = y + "px";
  }

  function moveNoButton(zone, btn){
    const rect = zone.getBoundingClientRect();
    const pad = 12;

    const bw = btn.offsetWidth || 200;
    const bh = btn.offsetHeight || 48;

    // Try a few random positions; avoid overlapping the Yes button area
    const yesArea = { x1: pad, y1: pad, x2: pad + 300, y2: pad + 90 };

    let x, y;
    for (let i=0;i<10;i++){
      x = rand(pad, Math.max(pad, rect.width - bw - pad));
      y = rand(pad, Math.max(pad, rect.height - bh - pad));

      const inYes =
        (x < yesArea.x2 && x + bw > yesArea.x1 && y < yesArea.y2 && y + bh > yesArea.y1);

      if (!inYes) break;
    }

    btn.style.left = x + "px";
    btn.style.top  = y + "px";
  }

  function rand(min, max){
    if (max <= min) return min;
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  // ======= Confetti =======
  const canvas = document.getElementById("fx");
  const ctx = canvas.getContext("2d");
  let W,H,particles=[],animating=false;

  function resize(){
    W = canvas.width = window.innerWidth * devicePixelRatio;
    H = canvas.height = window.innerHeight * devicePixelRatio;
  }
  window.addEventListener("resize", resize);
  resize();

  function popConfetti(n=120){
    for (let i=0;i<n;i++){
      particles.push({
        x: (Math.random()*W),
        y: -20,
        vx: (Math.random()*2-1) * 2.0,
        vy: (Math.random()*2+1) * 2.2,
        r: (Math.random()*6+3),
        a: 1,
        spin: (Math.random()*2-1)*0.18
      });
    }
    if (!animating) requestAnimationFrame(tick);
    animating = true;
  }

  function tick(){
    ctx.clearRect(0,0,W,H);
    for (const p of particles){
      p.x += p.vx * devicePixelRatio;
      p.y += p.vy * devicePixelRatio;
      p.vy *= 1.01;
      p.vx += Math.sin(p.y*0.01)*0.02;
      p.a *= 0.992;

      ctx.save();
      ctx.globalAlpha = Math.max(0, Math.min(1, p.a));
      ctx.translate(p.x, p.y);
      ctx.rotate(p.spin);
      ctx.fillStyle = "white";
      ctx.fillRect(-p.r/2, -p.r/2, p.r, p.r);
      ctx.restore();
    }
    particles = particles.filter(p => p.y < H+40 && p.a > 0.05);
    if (particles.length){
      requestAnimationFrame(tick);
    } else {
      animating = false;
    }
  }

  // boot
  render();
})();
</script>
</body>
</html>
